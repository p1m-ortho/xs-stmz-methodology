# METHOD.md

## Частота осложнений операций на позвоночнике против группы консервативного лечения: протокол исследования рутинных клинических данных центра неотложной взрослой хирургии позвоночника

## Примечание

Здесь пойдут какие-то общие правки по методам.

### Популяция

В соответствии с RECORD ([[@Benchimol2015]](https://pubmed.gov/26440803)), приводим в отдельности три уровня популяции:

1. Целевая популяция

    * Лица, для которых рассматривается вопрос об операции на позвоночнике.
    
2. Популяция базы данных

    * Медицинская информационная система НИИ скорой помощи им. И. И. Джанелидзе, где фиксируются все поступающие в институт пациенты, все выполняемые в институте операции и лучевые исследования и большая часть сведений из историй болезни (часть сведений при этом остается доступной только из бумажной истории), работает на полную силу ориентировочно с 2015 года.
    * Выбор только одного учреждения, причем именно этого, обусловлен производственными возможностями. При этом немаловажно отметить, что санкт-петербургский НИИ скорой помощи им. И. И. Джанелидзе является взрослым травмоцентром 1-го уровня, на уровне города специализирующемся в частности на лечении пострадавших с политравмой и пациентов с сепсисом, и на базе отделений института с 2010 функционирует городской центр неотложной хирургии позвоночника, в который распоряжением управления городским здравоохранением городскому бюро скорой помощи предписано направлять всех пациентов с острой спинальной патологией и пациентов со позвоночно-спинномозговой травмой со всей южной части города (подробнее см. в Дулаев А. К. и соавт., 2011, 2017, 2018). Другая часть пациентов с патологией позвоночника госпитализируется в институт планово.
    * Непосредственно к базе данных, обслуживающей МИС института, мы как исследователи не имеем доступа, поэтому IT-служба института по нашему техническому заданию сформировала запрос, в детали которого здесь углубляться не будем, так как это длинный разговор, см. для этого xs-led-dzhanelidze-global-spine-query. К пользованию этим запросом мы имеем свободный доступ и можем запускать его произвольное число раз.
    * Суть запроса в том, что он выбирает из всех случаев в базе случаи по двум критериям.
    * «Спинальная операция»: случаи, по которым выполнена операция с одним из внутренних кодов, которые мы расцениваем как спинальные (подробнее — в xs-led-dzhanelidze-global-spine-query).
    * «Спинальная КТ/МРТ»: случаи, не подошедшые по критерию «Спинальная операция», но по которым зарегистрировано хотя бы одно КТ- или МРТ-исследование, причем такое, в протоколе которого фигурирует текстовая маска «позвон». 
    * На выходе получаем таблицу Excel, где строками являются отдельные совпадения по критериям (то есть может быть более одной записи по одной госпитализации, если за данную госпитализацию выполнено несколько «спинальных операций» или «спинальных КТ/МРТ»), а поля — следующие:
    
        - № ИБ

            Номер медицинской карты, заведенной по случаю госпитализации.

        - Комп. номер пациента

            Уникальный номер пациента в МИС НИИ СП.

        - Фамилия
        - Имя
        - Отчество
        - Пол

            Женский или мужской.

        - Дата рождения
        - Дата поступления

            Дата и время поступления (часы и минуты).

        - Дата выписки

            Дата и время поступления (часы и минуты).
           
        - Вид осмотра

            Осмотр травматолога или осмотр нейрохирурга.

        - Тип осмотра

            Первичный, консультация, предоперационный эпикриз и так далее.

        - Протокол осмотра

            Полный текст осмотра.

        - Телефон дом.
        - Телефон сот.
        - Комментарий

            Комментарий к номеру телефона, предназначен для указания медицинским регистратором контактного лица.

            Иногда сам номер телефона оказывается внесен в это поле.

        - Адрес регистрации
        - Адрес проживания
        - Диагноз по МКБ-10

            Код МКБ-10 с различной точностью: от 3- до 5-значного кода, но обычно 4-значный.

            Соответствует коду выписного диагноза, который лицо, выписывающее пациента (обычно лечащий врач или ординатор), проставляет в статистическую карту выбывшего из стационара в бумажной истории болезни.

            Перенесение кода в МИС выполняют различные лица.

        - поле-индикатор пребывания на отделениях

            Если за весь период лечения пребывал хоть какое-то время на:
            
            * Травматологическом отделении No 1, вернуть 0001,
            * Травматологическом отделении No 2, вернуть 0010,
            * Нейрохирургическом отделении No 1, вернуть 0100,
            * Нейрохирургическом отделении No 2, вернуть 1000;
            * если успел побывать на ТО1 и на ТО2, 0011;
            * если успел побывать на всех этих отделениях, 1111;
            * если не переводился ни в одно из этих отделений, 0000
            * и т. д.

            Значение в этом поле подсчитывается автоматически в процессе выполнения запроса на основании данных МИС о движении пациентов между отделениями, и в выдаче по запросу мы видим уже заполненное поле.

        - Код операции

            Значение в это поле проставляет лицо, заполняющее протокол операции (хирург или ординатор), выбирая один из кодов из внутреннего списка, применяемого в НИИ СП.

            В качестве примера см. [коды спинальных операциий](https://github.com/p1m-ortho/xs-led-dzhanelidze-global-spine-query/blob/78283cc8ad9e151bacb246c082f1b49eacafffc4/METHOD.md#приложение-коды-спинальных-операций).

        - Дата операции
        - ASA

            Значение в это поле проставляет лицо, заполняющее протокол операции (хирург или ординатор), выбирая один вариант из этого списка:

            * Здоров
            * Легкие сист расс-ва
            * Значит сист расс-ва
            * Выраж. инв забол-е
            * Умирающий

        - Экстренная/ плановая

            Значение в это поле проставляет лицо, заполняющее протокол операции (хирург или ординатор), выбирая один из этих двух вариантов.

        - Полное наименование операции

            Стандартная формулировка, соответствующая данному коду операции.

        - Тип операции

            Значение в это поле проставляет лицо, заполняющее протокол операции (обычно хирург или ординатор), выбирая один вариант из этого списка:

            * Радикальная
            * Этапная
            * Паллиатив

        - Часов от момента поступления

            Значение в это поле проставляет лицо, заполняющее протокол операции (обычно хирург или ординатор), выбирая один вариант из этого списка:

            * в первые 6 часов
            * от 7 до 24 часов
            * позднее 24 часов

        - Вид обезболивания

            Значение в это поле проставляет лицо, заполняющее протокол операции (обычно хирург или ординатор), выбирая один вариант из этого списка:

            * местное
            * общее
            * в/в
            * сочетанная анестезия

        - Начало наркоза

            Значение в это поле проставляет лицо, заполняющее протокол операции (обычно хирург или ординатор), обычно на основании записи анестезиологической бригады, в часах и минутах.

        - Окончание наркоза

            Значение в это поле проставляет лицо, заполняющее протокол операции (обычно хирург или ординатор), обычно на основании записи анестезиологической бригады, в часах и минутах.

        - Послеоперационный диагноз

            Значение в это поле проставляет лицо, заполняющее протокол операции (обычно хирург или ординатор), в свободнотекстовой форме.

        - Описание операции/КТ/МРТ

            В зависимости от вида спинальности («Спинальная операция» или «Спинальная КТ/МРТ») поле содержит протокол операции (заполняет обычно хирург или ординатор) или протокол КТ- либо МРТ-исследования (заполняет обычно врач КТ или врач МРТ либо ординатор).

        - Вид спинальности

            «Спинальная операция» или «Спинальная КТ/МРТ».
    
3. Популяция исследования

    * Из результатов этого запроса мы выбираем только записи с датой поступления от 01.01.2018 и с датой выписки по 31.01.2019. Такой выбор обусловлен стремлением увязать все ныне текущие работы по РКД санкт-петербургского городского центра неотложной хирургии позвоночника (см. ветки xa-led-p1m-apr-conference) на одну субпопуляцию пациентов, а поскольку одна из работ — не по базе, а по опросникам,  данные по которым имеются в настоящее время только за данный период (для подробностей см. xc-led-dzhanelidze-proms-and-croms), то и ограничились и здесь им же.
    * Итоговую таблицу экспортируем в формат CSV, и дальнейшее сужение по ней см. в [разделе о методах получения данных из базы](#методы-получения-данных-из-базы).

## Методы получения данных из базы

Всю часть про работу с записями технически передумал делать не так. В каждом протоколе писать лень, поэтому пишу в общем здесь, но это и оправданно, потому что процесс не будет отличаться, и делать это буду в один присест.

А именно измененения по сравнению с протоколами будут следующими.

Сразу же выполню сортировку записей «Спинальная КТ/МРТ» случайным образом, как это описано в протоколах.

Для идиллии (чтобы у части записей не пустовало поле со случайным числом) записи «Спинальная операция» тоже случайно отсортирую аналогичным образом.

Загружу полученный CSV в FormTools.

Для этого в таблице к форме «Новая оценка» добавлю все те же поля, что есть в нашей выдаче (кстати, надо добавить список этих полей), и вставлю туда все записи.

Также добавлю для формы «Новая оценка» новый режим просмотра, который будет выводить только эти поля плюс поле для ссылки на форму «Новая запись» — все в нередактируемом виде.

Также ФИО, дату рождения и компьютерный номер (UPI) для всех записей из оригинального CSV скопирую в новый файл.

Устраню там 100%-ные дубликаты, документирую итоговое их число.

Затем добавлю эти записи в таблицу к форме «Новая запись».

Затем выполню SELECT LEFT JOIN таблицы «Новая запись» к таблице «Новая оценка» по полям ФИО, даты рождения и компьютерного номера (UPI).

Экспортирую результат в CSV, и из поля ID, взятого из формы «Новая запись», скопирую значения в сооветствующее связанное поле таблицы «Новая оценка».

Таким образом все записи будут полностью перенесены в FormTools.

Далее добавлю в таблицу к «Новой оценке» и соответствующему режиму просмотра следуюшие редактируемые поля:

* 4 бинарных поля-переключателя для факта вхождения по каждому из четырех регулярных выражений, приведенных в протоколах (Да / Нет);
* 4 бинарных поля-переключателя для оценки релевантности вхождений (Релеватно / Нерелеватно);
* числовое поле для нумерации групп записей (предполагаем, что между всеми четырьмя работами не будет ни одной пересекающейся группы, и поэтому одного поля должно быть достаточно);
* 4 поля-переключателя, отражающие принадлежность записи к основной или контрольной группе для каждой из 4 работ (основная группа / контрольная группа / не подходит);
* бинарное поле для фиксации наличия осложнений (Да / Нет);
* короткое свободнотекстовое поле на случай осложнений «Другое».

Дальше буду выполнять все аналогичные манипуляции, прописанные в протоколе, только к арсеналу инструментов добавится SQL (MySQL), и операции, которые рациональнее выполнить с помощью него, я буду выполнять с помощ него.

### Методы трансформации и анализа данных

> ПВЖ:
>
> Поработав по тезисам ССС с чеклистом [STROBE checklist for conference abstracts](http://www.strobe-statement.org/fileadmin/Strobe/uploads/checklists/STROBE_checklist_conference_abstract_DRAFT.pdf) и, дойдя до пункта «Report estimates of associations. If relevant, consider translating estimates of relative risk into absolute risk for a meaningful time period», обнаружили, что не подумали об этом.
>
> Обратились за разъяснениями по этому пункту к разъяснительному документу STROBE ([[@Vandenbroucke2007]](https://doi.org/10.1097/EDE.0b013e3181577511)), в результате чего пришли к пониманию того, что и для нас актуален этот пункт
>
> А именно актуально отразить в результатах number needed to harm (NNH) — «число лиц, подвергаемых лечению, для возникновения одного неблагоприятного исхода» (по аналогии с определением для number needed to treat в: Эпидемиологический словарь / под ред. Дж. М. Ласта., отв. ред. В. В. Власов. - 4-е изд. - М.: Открытый Институт Здоровья, 2009. - С. 245.).
>
> Что и сделаем во всех текущих работах по осложнениям (см. ветки xa-led-p1m-apr-conference) в дополнение к имеющимся методам.
>
> Соответствующее дополнение по методам см. ниже.

Подсчитаем и документируем общее количество групп с осложнениями и без них в основной и контрольной группах (4 числа).

Рассчитаем относительный риск (RR) и его 95%-ный ДИ, пользуясь [калькулятором RR от CCRB CUHK](https://www2.ccrb.cuhk.edu.hk/stat/confidence%20interval/CI%20for%20relative%20risk.htm).

Рассчитаем число лиц, подвергаемых хирургическому лечению, для возникновения одного осложнения (NNH) и его 95%-ный ДИ, пользуясь [калькулятором NNT от MedCalc](https://www.medcalc.org/calc/relative_risk.php).

Рассчитаем, пользуясь [калькулятором хи-квадрат от Jeremy Stangroom](https://www.socscistatistics.com/tests/chisquare2/default2.aspx), значение статистики хи-квадрат в тесте на независимость (1 степень свободы) и p-значение (2 числа).

### Результаты

Предстатавим только в текстовой форме в полном соответствии [разделу о методах трансформации и анализа данных](#методы-трансформации-и-анализа-данных).

Первичные данные сейчас публиковать не планируем, поскольку их анонимизация и подготовка к публикации займут дополнительное время, однако они будут доступны по запросу.

### Обсуждение

Интерпретируем полученный 95%-ный ДИ отношения шансов и NNH и p-значение.

Обсудим вопросы риска систематической ошибки, опираясь на схему ROBINS-I ([[@Sterne2016]](https://doi.org/10.1136/bmj.i4919)).

> ПВЖ: про ROBINS-I см. в METHOD.md в других ветках xa-led-p1m-apr-conference.

### Выводы

Интерпретируем полученные 95%-ные ДИ отношений шансов и NNH и p-значения.


## Финальный план по завершению работы над тезисами

**Сроки: срок написания финального варианта тезисов смещаем с утра на день 08.03, причины ясны из истории коммитов по веткам; срок отправки всех тезисов ДИК на проверку смещаем на утро 09.03**.

Финальный [почти наверняка](https://ru.wikipedia.org/wiki/Почти_достоверное_событие).

Это общий план, персонализированные для 5 из 5 авторов см.: [ЭБД](https://github.com/p1m-ortho/xa-led-p1m-apr-conference/blob/b18c821becc09b0f77061bcc63ab5f32791863b5/METHOD.md#финальный-план), [САС](https://github.com/p1m-ortho/xa-led-p1m-apr-conference/blob/888ba434d1b5338257f55216deb8bf6ee503e574/METHOD.md#финальный-план), [ССС](https://github.com/p1m-ortho/xa-led-p1m-apr-conference/blob/f054eee42f3904d1525d6e9a751a1cf9c7c8f8b0/METHOD.md#финальный-план), [РАБ](https://github.com/p1m-ortho/xa-led-p1m-apr-conference/blob/a943e67b44512ab5a2c3662fcc366f971d9661a2/METHOD.md#финальный-план), [НТМ](https://github.com/p1m-ortho/xa-led-p1m-apr-conference/blob/b37e58d41bf18a20c98732771333db9769f72246/METHOD.md#финальный-план).

> [23:05, 6.3.2019] Павел: Поскольку в пятницу все тезисы должен увидеть ДИК, реально из времени у нас остается только завтра. Поэтому завтра я возьму все, что кто успел наработать, и на основании этого постараюсь написать актуальность, цель и методы работы с базой и анализа полученных данных. Потом, по возможности, мы это с каждым обсудим, а дальше я собственно приступлю к реализации плана (работа с базой и анализ данных), а вы тем временем напишете окончательный вариант тезисов.

«Все, что кто успел наработать» — конкретно история коммитов в соответствующей ветке. Для каждой именной ветки я пройдусь в ней по каждому коммиту от начала и до конца.

А также пройду по каждому коммиту в мастере.

«Пройду» означает: прочту заголовок и тело коммита, ознакомлюсь с датой/давностью его подачи, ознакомлюсь с диффом. Все это буду делать — для ясности — в гитхабовском веб-интерфейсе.

> [23:08, 6.3.2019] Павел: Останется только в пятницу мне проставить туда цифры, и, по возможности, снова обсудив с каждым то, что получилось, я скомпилирую все тезисы в итоговые Word-файлы, которые отправлю ДИК.
> 
> [23:11, 6.3.2019] Павел: Дальше, в субботу и воскресенье, я займусь подготовкой документов на отправку, а вы все тем временем пройдете электронную регистрацию на конференцию.
> 
> [23:12, 6.3.2019] Павел: В воскресенье я отправлю всем готовые сканы тезисов с подписями и печатями, и Вы направите их в оргкомитет.

## Рассуждение 2

> [20:43, 6.3.2019] Павел: Хорошо. Давайте помыслим в конкретном русле.
> 
> [20:43, 6.3.2019] Павел: Конкретное русло заключается в том, что поджимают сроки по тезисам, и надо уже переходить к работе с базой, чтобы что-нибудь оттуда извлечь и что-нибудь на основании этого посчитать.
> 
> [20:44, 6.3.2019] Павел: Поскольку времени остается действительно мало, думаю, с базой я буду работать сам. В конце концов, я с самого начала говорил, что процесс извлечения оттуда информации носит сугубо технический характер.
> 
> [20:45, 6.3.2019] Павел: После того, как данные оттуда мы извлечем, нужно будет выполнить анализ этих данных — что-то посчитать.
> 
> [20:46, 6.3.2019] Павел: Более того, я Вам скажу, что и это процесс механический, и поэтому в условиях нехватки времени, думаю, его я тоже проделаю сам.
> 
> [20:51, 6.3.2019] Павел: В сухом остатке: что мне требуется для всего этого и что требуется сейчас и от меня, и от Вас — определиться, (а) с осмысленной целью проведения каких-либо манипуляций с этой базой, (б) содержанием этих манипуляций и (в) планом анализа полученных данных. Потом написать на основании всего этого эти чертовы тезисы на 1 лист, и вот тогда уже я действительно возьмусь за базу, а затем за анализ. Потом останется только вписать в написанные тезисы числа и согласно им скорректировать вывод — все, можно будет отправлять на проверку ДИК.


## Рассуждение 1

Я тут подумал, и коллективно по поводу тезисов сейчас вижу следующим образом.

У нас шести у всех в силу обстоятельств будут работы на основании т. н. рутинных клинических данных (РКД): НТМ, ЭБД, ССС, РАБ, ПВЖ — по МИС (медицинская информационная система) института Джанелидзе, САС — опросники, выдаваемые пациентам рутинно в институте Джанелидзе.

У всех — в рамках согласованных популяций (НТМ — вся вертебропластика; ЭБД — ДДЗП ШОП с неврологией; ССС — полиэтиологические деформации как причина обращения; РАБ — любые инфекции позвоночника; ПВЖ — повреждения типа C; ССС — любая спинальная патология).

По каждой теме необходимо найти актуальное приложение работы по РКД — _актуальность_.

Я так и не нашел времени завершить это рассуждение.