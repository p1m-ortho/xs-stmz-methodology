# METHOD.md

## Качество жизни (SF-36) и уровень боли (UPAT) в общей популяции…: журнал исследования (САС)

Изначальное число опросников: 121. После решения объединить в одну единицу опросники, собранные у одного человека в одну дату, Число единиц сократилось до 113 (по причине объединения опросников, собранных в один день проспективно и ретроспективно). Единицы, собранные исключительно ретроспективно, коорые не являются опросниками SF-36 и UPAT, а также невыданные по каким-либо причинам опросники не подходят для внесения их в качестве новых оценок. Исходя из этого, были исключены 3 единицы: 1 взят ретроспективно, 1 - ASIA, 1 - не выдан. Итого для внесения - 110 единиц.

## Качество жизни (SF-36) и уровень боли (UPAT) в общей популяции…: журнал исследования (ПВЖ)

Генерация случайной последовательности внесения опросников ([RANDOM.ORG](https://https://www.random.org/integer-sets)): 

Параметры генерации:

```
Step 1: The Sets
Generate 1 set(s) with 113 unique random integer(s) in each.

Each integer should have a value between 1 and 113 (both inclusive; limits ±1,000,000,000).

The total number of integers must be no greater than 10,000.

Step 2: Display Options
 
 Each set will be printed on a separate line. You can choose from the following extra options:
 V Number the sets sequentially
 V Use commas to separate the set members
 X Sort the members of each set in ascending order

You can select the order in which the sets are printed:
 V Print the sets in the order they were generated
 0 Order the sets by the values that occur in them (in this case, you should also consider sorting the members of each set)
 0 Print the sets in random order

 Step 3: Go!
Be patient! It may take a little while to generate your sets...
```

Результат генерации:

```
You requested 1 set with 113 unique random integers, taken from the [1,113] range. The integers were not sorted.

Here is your set:

Set 1: 94, 67, 92, 48, 18, 36, 47, 2, 109, 41, 103, 89, 81, 60, 95, 66, 14, 15, 76, 57, 105, 106, 74, 79, 5, 88, 93, 96, 25, 33, 30, 77, 28, 8, 108, 44, 73, 29, 21, 27, 97, 68, 107, 34, 31, 58, 71, 39, 63, 100, 49, 85, 64, 17, 80, 9, 111, 59, 72, 70, 3, 52, 110, 24, 32, 23, 53, 19, 45, 42, 65, 10, 7, 1, 12, 4, 38, 86, 51, 11, 84, 6, 40, 82, 113, 62, 99, 20, 69, 112, 104, 50, 46, 35, 54, 26, 61, 98, 101, 13, 22, 56, 90, 78, 75, 55, 87, 91, 16, 102, 43, 37, 83
Timestamp: 2019-03-10 11:48:14 UTC
```

Добавил в «Новую оценку» специальное поле `upat_sf36_trng`, куда внесу сейчас 113 новых (пустых) записей, в которых заполню это поле сгенерированной последовательностью.

Сортировку по умолчанию ставлю по ~~этому полю~~ полю ID по возрастанию.

Копипаста из FormTools теперь выглядит так:

```
ЗаказПолеТип поляEditableПоиск
1TRNGТекстовое поле
2ЗаписьRecord Picker 
3DateСвидание 
4Last modifiedСвидание
5IP AddressТекстовое поле 
Добавить поле (ы) »

ЗаказПолеТип поляEditableПоиск
1Время измерения: шкалаРаскрывающийся 
2Другая шкала времени измеренияTextarea 
Добавить поле (ы) »

ЗаказПолеТип поляEditableПоиск
1Время измерения: вид точечной оценкиРаскрывающийся 
2Время измерения: значение точечной оценкиTextarea 
Добавить поле (ы) »

ЗаказПолеТип поляEditableПоиск
1Время измерения: вид интервальной оценкиРаскрывающийся 
2Время измерения: нижняя граница интервалаТекстовое поле 
3Время измерения: верхняя граница интервалаТекстовое поле 
Добавить поле (ы) »

ЗаказПолеТип поляEditableПоиск
1Независимая переменная: шкалаРаскрывающийся 
2Другая шкала независимой переменнойTextarea 
Добавить поле (ы) »

ЗаказПолеТип поляEditableПоиск
1Независимая переменная: вид точечной оценкиРаскрывающийся 
2Независимая переменная: значение точечной оценкиTextarea 
Добавить поле (ы) »

ЗаказПолеТип поляEditableПоиск
1Независимая переменная: вид интервальной оценкиРаскрывающийся 
2Независимая переменная: нижняя граница интервалаТекстовое поле 
3Независимая переменная: верхняя граница интервалаТекстовое поле 
Добавить поле (ы) »

ЗаказПолеТип поляEditableПоиск
1Боль от 0 до 10, баллы (UPAT)Переключатели 
2Боль от 0 до 5, рожицы (UPAT)Переключатели 
3Боль от 0 до 5, переносимость (UPAT)Переключатели 
Добавить поле (ы) »

ЗаказПолеТип поляEditableПоиск
1Вопрос 1 (SF-36)Переключатели 
2Вопрос 2 (SF-36)Переключатели 
3Вопрос 3-А (SF-36)Переключатели 
4Вопрос 3-Б (SF-36)Переключатели 
5Вопрос 3-В (SF-36)Переключатели 
6Вопрос 3-Г (SF-36)Переключатели 
7Вопрос 3-Д (SF-36)Переключатели 
8Вопрос 3-Е (SF-36)Переключатели 
9Вопрос 3-Ж (SF-36)Переключатели 
10Вопрос 3-З (SF-36)Переключатели 
11Вопрос 3-И (SF-36)Переключатели 
12Вопрос 3-К (SF-36)Переключатели 
13Вопрос 4-А (SF-36)Переключатели 
14Вопрос 4-Б (SF-36)Переключатели 
15Вопрос 4-В (SF-36)Переключатели 
16Вопрос 4-Г (SF-36)Переключатели 
17Вопрос 5-А (SF-36)Переключатели 
18Вопрос 5-Б (SF-36)Переключатели 
19Вопрос 5-В (SF-36)Переключатели 
20Вопрос 6 (SF-36)Переключатели 
Добавить поле (ы) »

ЗаказПолеТип поляEditableПоиск
1Вопрос 7 (SF-36)Переключатели 
2Вопрос 8 (SF-36)Переключатели 
3Вопрос 9-А (SF-36)Переключатели 
4Вопрос 9-Б (SF-36)Переключатели 
5Вопрос 9-В (SF-36)Переключатели 
6Вопрос 9-Г (SF-36)Переключатели 
7Вопрос 9-Д (SF-36)Переключатели 
8Вопрос 9-Е (SF-36)Переключатели 
9Вопрос 9-Ж (SF-36)Переключатели 
10Вопрос 9-З (SF-36)Переключатели 
11Вопрос 9-И (SF-36)Переключатели 
12Вопрос 10 (SF-36)Переключатели 
13Вопрос 11-А (SF-36)Переключатели 
14Вопрос 11-Б (SF-36)Переключатели 
15Вопрос 11-В (SF-36)Переключатели 
16Вопрос 11-Г (SF-36)Переключатели 
Добавить поле (ы) »
```

Доступ к форме на момент внесения изменений пока закрыл.

Структура таблицы «Новая оценка» в настоящий момент:

```sql
CREATE TABLE `ft_form_1` (
  `submission_id` mediumint(8) unsigned NOT NULL AUTO_INCREMENT,
  `record` varchar(255) DEFAULT NULL,
  `t_m` varchar(255) DEFAULT NULL,
  `t_per` varchar(255) DEFAULT NULL,
  `t_pee` varchar(255) DEFAULT NULL,
  `t_ier` varchar(255) DEFAULT NULL,
  `t_iee_ll` varchar(255) DEFAULT NULL,
  `t_iee_ul` varchar(255) DEFAULT NULL,
  `iv_m` varchar(255) DEFAULT NULL,
  `iv_per` varchar(255) DEFAULT NULL,
  `iv_pee` mediumtext,
  `iv_ier` varchar(255) DEFAULT NULL,
  `iv_iee_ll` varchar(255) DEFAULT NULL,
  `iv_iee_ul` varchar(255) DEFAULT NULL,
  `dv_m` varchar(255) DEFAULT NULL,
  `dv_per` varchar(255) DEFAULT NULL,
  `dv_pee` mediumtext,
  `dv_ier` varchar(255) DEFAULT NULL,
  `dv_iee_ll` varchar(255) DEFAULT NULL,
  `dv_iee_ul` varchar(255) DEFAULT NULL,
  `submission_date` datetime NOT NULL,
  `last_modified_date` datetime NOT NULL,
  `ip_address` varchar(15) DEFAULT NULL,
  `is_finalized` enum('yes','no') DEFAULT 'yes',
  `t_m_ft` varchar(255) DEFAULT NULL,
  `iv_m_ft` varchar(255) DEFAULT NULL,
  `dv_m_ft` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q1` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q2` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q3` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q4` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q5` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q6` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q7` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q8` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q9` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q10` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q11` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q12` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q13` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q14` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q15` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q16` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q17` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q18` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q19` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q20` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q21` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q22` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q23` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q24` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q25` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q26` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q27` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q28` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q29` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q30` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q31` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q32` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q33` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q34` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q35` varchar(255) DEFAULT NULL,
  `dv_m_sf36_q36` varchar(255) DEFAULT NULL,
  `dv_m_upat_0_10_point` varchar(255) DEFAULT NULL,
  `dv_m_upat_0_5_face` varchar(255) DEFAULT NULL,
  `dv_m_upat_0_5_disability` varchar(255) DEFAULT NULL,
  `upat_sf36_trng` mediumint(8) unsigned DEFAULT NULL,
  PRIMARY KEY (`submission_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

Для лучшего понимания смысла полей можно обратиться к xs-stmz-methodology и xc-led-dzhanelidze-proms-and-croms.

Запрос на внесение:

```sql
INSERT INTO `ft_form_1` (`upat_sf36_trng`, `submission_date`)
VALUES (94, NOW()), (67, NOW()), (92, NOW()), (48, NOW()), (18, NOW()), (36, NOW()), (47, NOW()), (2, NOW()), (109, NOW()), (41, NOW()), (103, NOW()), (89, NOW()), (81, NOW()), (60, NOW()), (95, NOW()), (66, NOW()), (14, NOW()), (15, NOW()), (76, NOW()), (57, NOW()), (105, NOW()), (106, NOW()), (74, NOW()), (79, NOW()), (5, NOW()), (88, NOW()), (93, NOW()), (96, NOW()), (25, NOW()), (33, NOW()), (30, NOW()), (77, NOW()), (28, NOW()), (8, NOW()), (108, NOW()), (44, NOW()), (73, NOW()), (29, NOW()), (21, NOW()), (27, NOW()), (97, NOW()), (68, NOW()), (107, NOW()), (34, NOW()), (31, NOW()), (58, NOW()), (71, NOW()), (39, NOW()), (63, NOW()), (100, NOW()), (49, NOW()), (85, NOW()), (64, NOW()), (17, NOW()), (80, NOW()), (9, NOW()), (111, NOW()), (59, NOW()), (72, NOW()), (70, NOW()), (3, NOW()), (52, NOW()), (110, NOW()), (24, NOW()), (32, NOW()), (23, NOW()), (53, NOW()), (19, NOW()), (45, NOW()), (42, NOW()), (65, NOW()), (10, NOW()), (7, NOW()), (1, NOW()), (12, NOW()), (4, NOW()), (38, NOW()), (86, NOW()), (51, NOW()), (11, NOW()), (84, NOW()), (6, NOW()), (40, NOW()), (82, NOW()), (113, NOW()), (62, NOW()), (99, NOW()), (20, NOW()), (69, NOW()), (112, NOW()), (104, NOW()), (50, NOW()), (46, NOW()), (35, NOW()), (54, NOW()), (26, NOW()), (61, NOW()), (98, NOW()), (101, NOW()), (13, NOW()), (22, NOW()), (56, NOW()), (90, NOW()), (78, NOW()), (75, NOW()), (55, NOW()), (87, NOW()), (91, NOW()), (16, NOW()), (102, NOW()), (43, NOW()), (37, NOW()), (83, NOW())
```

Успех, ожидаемых 113 записей внесено.

Проверяю: успешно внесено в таблицу, дата добавления проставлена, правильная, в FormTools отбражаются.

Вот только старые записи идут вперед этих, что неудивительно, коль скоро сортировка — ~~по TRNG по возрастанию~~, у старых записей, с очевидностью, значение `NULL` в этом поле. Сортировать по TRNG, без сомнения, было глупостью, коль скоро мы хотим, чтобы записи следовали в случайном порядке; сделал сортировку по ID.

Поэтому пока поставлю для старых записей `NULL` в поле `is_finalized`, и тогда FormTools перестанет их видеть.

По завершении работы всегда можно будет вернуть им `yes`, поскольку эти 113 однозначно определяются, во-первых, непустым `upat_sf36_trng`, а во-вторых, одной и той же известной `submission_date`.

Так что запрос:

```sql
UPDATE `ft_form_1`
SET `is_finalized` = NULL
WHERE `upat_sf36_trng` IS NULL
```

Успешно обновил ожидаемые 24 записи.

Проверяю в FormTools: успешно пропали оттуда, теперь там 113 записей.

Кнопку добавления записей также пока временно отключаю.

Включаю назад доступ к форме — а нет, момент.

Ха, а сортировка по TRNG — это нонсенс; коль скоро мы хотим, чтобы записи следовали в случайном порядке

Ссделал сортировку по ID.

Теперь точно все в порядке:

* в «Новой оценке» сейчас 113 пустых записей,
* порядок их следования совпадает со случайной последовательностью, сгенерированной выше,
* добавление новых записей отключено,
* редактирование поля TRNG также отключил,
* из группы «Объект измерения» все поля, кроме «TRNG» и «Запись» (список их см. выше в копипасте), убрал: они сейчас не нужны, будут только мешаться,
* возможность ручной сортировки по всем полям тоже отключил.

Все, можно приступать к заполнению.

Включаю назад доступ к форме — готово.

Закрываю доступ к форме.

Выбираю всего заполненных записей:

```sql
SELECT *
FROM `ft_form_1`
WHERE `is_finalized` = 'yes' AND `record` IS NOT NULL
```

Итого 41 запись.

Начинаю считать SF-36 с UPAT:

## Качество жизни (SF-36) и уровень боли (UPAT) в общей популяции стационарных пациентов с травмами и заболеваниями позвоночника: протокол поперечного исследования рутинных клинических данных центра неотложной взрослой хирургии позвоночника

### Оповещение

ПВЖ:

> С учетом того, что уже написан неплохой вариант тезисов (6750d68df1f1dd7e515d6d2e8dc796aa0fb5ed44), который сравнительно быстро доработать до протокола, а также с учетом того, что работа с опросниками, в том числе порядок их сбора, оцифровки перенесения в FormTools, уже довольно подробно описаны здесь и в других репозиториях (xc-led-dzhanelidze-proms-and-croms и xs-stmz-methodology), считаю, нет необходимости с нуля писать протокол.
>
> Поэтому беру уже ранее обсужденный и написанный САС черновик тезисов (6750d68df1f1dd7e515d6d2e8dc796aa0fb5ed44) и дорабатываю его до протокола.

### Актуальность

В сфере спинальной хирургии в настоящее время по многим вопросам: позвоночно-спинномозговая травма ([[@Abudou2013]](https://doi.org/10.1002/14651858.CD005079.pub3)), инфекционные поражения ([[@Jutte2006]](https://doi.org/10.1002/14651858.CD004532.pub2)), дегенеративно-дистрофические заболевания ([[@Nikolaidis2010]](https://doi.org/10.1002/14651858.CD001466.pub3)), деформации ([[@Cheuk2015]](https://doi.org/10.1002/14651858.CD005375.pub4), [[@BettanySaltikov2015]](https://pubmed.gov/25908428)) позвоночника — по-прежнему нет качественных исследований на предмет преимущества оперативного лечения перед консервативным. Одним из принципиальных этапов планирования таких исследований является определение минимальной клинически значимой разницы по основным исходам работы ([[@Cook2015]](https://doi.org10.1186/s13063-014-0526-8)), которые в исследованиях клинической эффективности обычно представлены пациент-значимыми исходами: функция, боль, качество жизни, связанное со здоровьем, и общее качество жизни. Данная работа направлена на сбор популяционных данных показателей боли и уровня качества жизни пациентов со спинальной патологией для использования их при планировании дальнейших исследований.

### Цель
 
Сбор, оцифровка и оценка популяционных показателей уровня боли (по UPAT) и качества жизни (по опроснику SF-36) пациентов со спинальной патологией.

### Релеватные специальные руководства по проведению и написанию исследования такого дизайна

The Strengthening the Reporting of Observational Studies in Epidemiology (STROBE) statement: guidelines for reporting observational studies ([[@Elm2007]](https://pubmed.gov/18313558)).

Strengthening the Reporting of Observational Studies in Epidemiology (STROBE): Explanation and Elaboration ([[@Vandenbroucke2007]](https://doi.org/10.1097/EDE.0b013e3181577511)).

[STROBE checklist for conference abstracts](http://www.strobe-statement.org/fileadmin/Strobe/uploads/checklists/STROBE_checklist_conference_abstract_DRAFT.pdf).

### Популяция

Вся популяция пациентов, обслуживаемая спинальной службой института, включает:

* Стационированные в отделение травматологии и ортопедии № 2, 1, другие отделения НИИ скорой помощи имени И. И. Джанелидзе со спинальным основным диагнозом.
* Поступившие в НИИ скорой помощи имени И. И. Джанелидзе, консультируемые травматологом-ортопедом или нейрохирургом, с клиникой или анамнезом со стороны позвоночника.
* Планово амбулаторно консультируемые вертебрологом НИИ СП с клиникой или анамнезом со стороны позвоночника очно и заочно.

В рамках данного исследования будут рассмотрены только те из этих пациентов, которые находились в стационарном лечении в НИИ СП, поступили институт за период с 01.01.2018 включительно и выписались до 31.01.2019 включительно и у которых мы взяли соответствующие опросники (SF-36 и UPAT, см. ниже).

Ограничение популяции только стационарными пациентами и выбор такого временного интервала обусловлен стремлением обеспечить согласованность популяции этого исследования с популяциями тех исследований, что сейчас проводятся параллельно (см. другие ветки xa-led-p1m-apr-conference).
 
### Методы сбора данных

Для оценки качества жизни был использован опросник SF-36, для оценки уровня боли была использована универсальная шкала оценки боли — UPAT ([[@Cutler2016]](https://pubmed.gov/27853666)). Сбор данных производился в СПб НИИ СП им. И. И. Джанелидзе в период с января 2018 г. по январь 2019 г. Пациентам с патологией позвоночника, консультировавшимся или проходившим лечение в данный период, было предложено заполнить опросник SF-36 и провести оценку уровня боли по UPAT. Детальное описание процесса сбора данных см. в специальных репозиториях (xc-led-dzhanelidze-proms-and-croms и xs-stmz-methodology).

Практически все опросники за этот период (кроме одного пациента) в настоящее время подшиты в папку в порядке даты их заполнения.

Для последующей обработки произведем перенос сведений из бумажных опросников в базу данных (InnoDB MySQL, графический интерфейс [FormTools](https://formtools.org), детали см. в xs-stmz-methodology).

Перенос выполнит 1 исследователь (САС), руководствуясь следующим порядком:

* опросники подлежат перенесению в FormTools в случайном порядке: в порядке несортированной последовательности неповторяющихся случайных чисел, сгенерированных на [RANDOM.ORG](https://random.org);
* при этом при подсчете числа для генерации списка случайных чисел подсчету подлежат все бланки опросников, на которых стоит дата с января 2018 по январь 2019, вне зависимости от того, подходят они для этого исследования или нет (в частности бланки ASIA), причем бланки разных опросников, заполненных одним пациентом в один и тот же день, при подсчете следует считать за единицу;
* собственно переносу в FormTools подлежат все опросники SF-36 и UPAT, на которых стоит дата с января 2018 по январь 2019, заполненные проспективно (считаются заполненными проспективно, если на них не написана соответствующая пометка «ретроспективно»); количество таких опросников также необходимо подсчитать аналогичным образом.

Перед переходом к переносу необходимо будем задокументировать рассчитанные выше количества опросников:

* общее число опросников, на которых стоит дата с января 2018 по январь 2019;
* число опросников SF-36 и UPAT, на которых стоит дата с января 2018 по январь 2019.

Сам процесс переноса будет заключаться во внесении данных в специальном режиме просмотра формы «Новая оценка» (см. подробнее в xc-led-dzhanelidze-proms-and-croms).

Все опросники, на которых значатся одни и те же ФИО и дата, либо скрепленные степлером, подлежат внесению в одну и ту же «Новую оценку».

Поля в «Новой оценке», которые необходимо заполнить:

* Поле со ссылкой на запись из таблицы «Новая запись».

    При переносе записей в таблицу «Новая запись» (см. про это в d3f687421e73286defb56a46509ff76faa2b954a) в списке записей для формы «Новая оценка» появятся все пациенты, поступившие за период с 01.01.2018 включительно и выписавшиеся до 31.01.2019 включительно.

    При наличии ФИО, отраженного на опроснике, в данном списке, будем выбирать эту запись.

    При отсутствии ФИО в списке будем добавлять новую запись форму «Новую запись» и ссылаться на нее.

* Поле для точечной оценки времени измерения.

    Необходимо и достаточно будет внести туда дату, проставленную на опроснике.

* Выбрать варианты ответов, соответствующие таковым в опроснике, посредством элементов управления — переключателей на вкладке «Лицевая сторона SF-36».

* Выбрать варианты ответов, соответствующие таковым в опроснике, посредством элементов управления — переключателей на вкладке «Оборотная сторона SF-36».

* Выбрать варианты ответов, соответствующие таковым в опроснике, посредством элементов управления — переключателей на вкладке «UPAT».

### Методы трансформации данных

Посредством SQL выполним следующий запрос:

* Выберем из таблицы «Новая оценка» все записи.
* Посредством LEFT JOIN присоединим к ней по полю, содержащему ссылку на поле ID таблицы «Новая запись», записи из таблицы «Новая запись».
* Оставим только следующие поля:

    * поля таблицы «Новая оценка, содержащие значения по SF-36 (36 полей);
    * поля таблицы «Новая оценка, содержащие значения UPAT (3 поля);
    * поле с ФИО таблицы «Новая запись»;
    * поле с датой рождения таблицы «Новая запись»;
    * поле «№ и/б / PMID / DOI / другой ID» таблицы «Новая запись»;
    * поле с временным штампом создания записи из таблицы «Новая запись».

* На основании полей, содержащих значения по SF-36 (36 полей), и следуя [официальной инструкции по обработке опросников SF-36](https://www.rand.org/health-care/surveys_tools/mos/36-item-short-form/scoring.html), подсчитаем значения каждого из восьми доменов SF-36 для каждой из записей.
* В итоге запрос должен будет вернуть нам записи общим числом, равным числу опросников, и будет содержать значения для всех 8 доменов SF-36 и значения по каждой из 3 шкал оценки боли, входящих в UPAT.

А именно следующий SQL-запрос:

```

```

Экспортируем результаты запроса в CSV-файл.

Из получившихся записей выберем только те, для которых значение временного штампа равно значению, которое будет проставлено в записи таблицы «Новая запись» в момент автоматического их добавления (см. на эту тему d3f687421e73286defb56a46509ff76faa2b954a).

Это необходимо потому что среди опросников могут быть:

* собранные у пациентов, поступивших до 01.01.2018 и выписавшимися после 31.01.2019, но опрошенных в период с января 2018 по январь 2019, а такие пациенты не попадают в рассматриваемый временной интервал;
* собранные амбулаторно, а поскольку такие приходящие пациенты никак не фиксируются в МИС НИИ СП, то и в «Новой записи» данных по этим пациентам может не оказаться, а значит необходимо будет вносить их вручную, к тому же они также могут не попадать в означенный период.

Еще одним простым SQL-запросом получим общее количество записей с таким временным штампом в таблице «Новая запись» — оно будет отражать общее число пациентов в популяции, документируем его.

Затем, открыв CSV-файл как таблицу в каком-либо редакторе, путем фильтрации записей выделим и документируем также:

* общее число пациентов, для которых взят хотя бы один опросник SF-36;
* общее число пациентов, для которых взят хотя бы один опросник UPAT.

### Методы работы с недостающими данными

Форму для внесения опросников в FormTools спроектировали таким образом, чтобы в случае некорректных или отсутствующих данных в базу вносилось значение `NA` (см. подробнее в xc-led-dzhanelidze-proms-and-croms).

Выполнив несколько простых UNION SQL-запросов получим и документируем:

* общее количество заполненных ответов по SF-36;
* общее количество заполненных ответов по UPAT;
* количество ответов `NA` по SF-36;
* количество ответов `NA` по UPAT.

При расчетах значения `NA` будем игнорировать.

### Методы анализа данных

Рассчитаем при помощи [калькулятора пропорций и их 95%-ных ДИ от Richard Lowry](http://vassarstats.net/prop1.html):

* долю пациентов, для которых есть данные по SF-36 в выборке, от общей численности популяции и ее 95%-ный ДИ;
* долю пациентов, для которых есть данные по UPAT в выборке, от общей численности популяции и ее 95%-ный ДИ;
* долю ответов `NA` по SF-36 и ее 95%-ный ДИ;
* долю ответов `NA` по UPAT и ее 95%-ный ДИ.

Рассчитаем при помощи [калькулятора средних и их 95%-ных ДИ от GraphPad](https://www.graphpad.com/quickcalcs/CImean1/)

* среднее значение и 95%-ный ДИ для каждого из восьми доменов SF-36 (24 числа);
* среднее значение и 95%-ный ДИ по каждой из трех шкал оценки боли, входящих в UPAT (9 чисел).

### Результаты

Представим строго согласно [разделу о методах анализа данных](#методы-анализа-данных).

### Обсуждение

Обсудим перспективы применения полученных данных при планировании исследований в вертебрологии, целесообразность дальнейшего изучения этих показателей в подгруппах, а также потребность в выполнении обзора литературы по этому вопросу.

### Выводы

Здесь сообщим, что были получены среднепопуляционные значения качества жизни (SF-36) и уровня боли (UPAT) для пациентов со спинальной патологией, которые могут быть полезны при планировании дальнейших исследований.

## Журнал изменений от финального плана до согласования протокола (от новых к старым)

ПВЖ: попросил САС пока не вносить опросники (вроде бы еще не приступила): дождаться, пока не допишу и не согласуем протокол по этой работе, а также пока не согласуем остальные 4 протокола (см. другие ветки xa-led-p1m-apr-conference).

САС сообщила, что приступает ко внесению данных из опросников.

**Еще раз подытоживаем:**

* **опросники подлежат перенесению в FormTools в случайном порядке: в порядке несортированной последовательности неповторяющихся случайных чисел, сгенерированных на [RANDOM.ORG](https://random.org);**
* **при этом при подсчете числа для генерации списка случайных чисел подсчету подлежат все бланки опросников, на которых стоит дата с января 2018 по январь 2019, вне зависимости от того, подходят они для этого исследования или нет (в частности бланки ASIA), причем бланки разных опросников, заполненных одним пациентом в один и тот же день, при подсчете следует считать за единицу;**
* **собственно переносу в FormTools подлежат все опросники SF-36 и UPAT, на которых стоит дата с января 2018 по январь 2019.**

Проговорили еще раз порядок работы с формой (см. коммиты в xs-stmz-methodology от 2019-03-06).

Проговорили еще раз важность внесения в случайном порядке на случай, если вдруг не успеем внести все, а также порядок генерации несортированной последовательности неповторяющихся случайных чисел на [RANDOM.ORG](https://random.org).

Согласовали еще раз период, за который вносим опросники (с января 2018 по январь 2019), при этом обратили внимание на то, что туда может попасть часть пациентов, не подходящая под критерии: дата поступления с 01.01.2018 и дата выписки до 31.01.2019.

~~Обсудили возможный способ коррекции: взять уже по завершении внеснения все опросники за январь 2018 и 2019 и вручную проверить даты поступления и выписки этих пациентов,— однако не приняли окончательное решение, будем предпринимать это в настоящей работе или нет.~~

**Пришло внезапное решение вопроса: при переносе записей в таблицу «Новая запись» (см. про это в d3f687421e73286defb56a46509ff76faa2b954a) в списке записей для формы «Новая оценка» появятся все пациенты, поступившие за этот период и не появятся пациенты, не поступившие в этот период, а значит одновременно с тем, что отпадет необходимость вручную добавлять «Новые записи» при перенесении из опросников, будет решена и проблема с поступившими до 01.01.2018 и выписавшимися после 31.01.2019, но опрошенными в период с января 2018 по январь 2019.**

**Однако с учетом того, что среди опросников есть и опросники, собранные амбулаторно, а такие приходящие пациенты никак не фиксируются в МИС НИИ СП, то и в «Новой записи» данных по этим пациентам может не оказаться, а значит необходимо будет вносить их вручную, к тому же они также могут не попадать в означенный период.**

**Таким образом, чтобы однозначно решить проблему несовпадающих популяций, необходимо будет при обработке данных уже после перенесения всех опросников исключить из рассмотрения те «Новые оценки», для которых временной штамп создания соответствующей «Новой записи» не совпадает с временным штампом, который будет проставлен в момент автоматического добавления «Новых записей» (d3f687421e73286defb56a46509ff76faa2b954a).**

САС обратила внимание, что практически все опросники за этот период (кроме одного пациента) в настоящее время подшиты в папку в порядке даты их заполнения.

Согласовали, что при подсчете числа опросников для генерации списка случайных чисел будем подсчитывать все бланки за данный период вне зависимости от того, подходят они для этого исследования или нет (в частности бланки ASIA), причем бланки разных опросников, заполненных одним пациентом в один и тот же день, будем при подсчете считать за единицу.

Результаты подсчета опросников и результировавшую последовательность случайных чисел документируем здесь.

ПВЖ:

> 07.03.19, 12:22 - Павел: Но прежде всего я все еще жду от Вас обговоренный коммит с планом тезисов.
>
> 07.03.19, 12:24 - Павел: И, когда сядете за опросники (вижу в FormTools, что пока не сели), первым делом закоммитьте их число (число измерений, то есть UPAT и SF-36, снятые в один день, считать за один; все, кроме UPAT и SF-36, сейчас игнорируйте).
>
> 07.03.19, 12:29 - Павел: И все же желательно даже из бумажного варианта в случайном порядке их заносить, Света… Для надежности нужно будет сгенерировать список случайных чисел без повторений (как только скажете мне общее число опросников, я Вам помогу с его генерацией), и вносить по этому списку. Допустим, сначала 2-й в стопке, затем 27-й, затем 13-й и так далее. При этом после начала переноса порядок их следования в стопке уже не меняете, то есть взяли 2-й, внесли, сунули назад в ту же позицию. Взяли 27-й, внесли, сунули опять в 27-ю позицию. И так далее.

САС сообщила о решении использовать для заполнения формы бумажные версии опросников.

## Финальный план

На основе [общего финального плана](https://github.com/p1m-ortho/xa-led-p1m-apr-conference/blob/6e81446762c59f950bf189aa90db1e65d6d9cfdd/METHOD.md).

> [23:51, 6.3.2019] Павел: Ладно, Света, Вы там где-то в полуживом-полумертвом виде, я чувствую, ладно. Что на завтра. Посмотрите финальный план до 10.03 в общем чате. Постарайтесь в четверг, начав все же с закоммичивания плана по тезисам, что мы обсудили (и Вы даже вроде как записали), все же повносить в форму опросники.
> 
> [23:51, 6.3.2019] Павел: Чтобы подстраховаться, сделайте следующим образом.
> 
> [23:52, 6.3.2019] Павел: Вы ведь планировали переносить с фотографий? Вот и переносите с фотографий.
> 
> [00:15, 7.3.2019] Павел: Дальше надо понять, как Вы фоткали: действительно ли на каждую отдельную сторону (лицевой SF, оборотный SF и UPAT) есть по отдельной фото.
> 
> [00:17, 7.3.2019] Павел: Если так, то нужно будет сперва отделить все UPAT в одну сторону и все посторонние в настоящий момент фото (ASIA и т. д.) — в другую, и тогда останутся в директории только SF-36: каждые 2 файла = 1 опросник.
> 
> [00:18, 7.3.2019] Павел: Но велик шанс, что если тыл у опросника не заполнен, то Вы такой тыл и не фоткали, и поэтому правило: «2 файла = 1 опросник» — может и не сработать.
> 
> [00:22, 7.3.2019] Павел: В этом случае оптимально будет все фотки, которые Вы сделали за все время, вручную разделить в 6 каталогов: (1) декабрь 2017 и ранее (если есть), (2) февраль 2019 и позднее, (3) UPAT с янв. '18 по янв. '19, (4) лицевые SF-36 с янв. '18 по янв. '19, (5) тыльные SF-36 с янв. '18 по янв. '19 и (6) не UPAT и не SF-36 с янв. '18 по янв. '19.
> 
> [00:23, 7.3.2019] Павел: После этого, наконец, выполнить счет опросников: сколько файлов в лицевых SF-36 и сколько в UPAT.
> 
> [00:24, 7.3.2019] Павел: Все выше- и нижеизложенное, несомненно, необходимо по ходу процесса отражать в Гите.
> 
> [00:25, 7.3.2019] Павел: Затем сделать седьмую папку и скопировать туда все файлы из лицевой и тыльной.
> 
> [00:26, 7.3.2019] Павел: Посчитать тоже там число файлов, отразить это в Гите.
> 
> [00:27, 7.3.2019] Павел: Затем сформировать автоматически список названий файлов из папки с UPAT, вылить его в Гит, зайти на RANDOM.ORG, случайно отсортировать, вылить снова в Гит.
> 
> [00:28, 7.3.2019] Павел: То же повторить для каталога с лицевыми SF-36.
> 
> [00:28, 7.3.2019] Павел: После этого из каталога с UPAT скопировать все файлы в 7-й каталог.
> 
> [00:28, 7.3.2019] Павел: Записать снова число файлов, закоммитить.
> 
> [00:29, 7.3.2019] Павел: И вот теперь только можно приступить к перенесению из опросников.
> 
> [00:32, 7.3.2019] Павел: Вернее, нет: теперь взять списки названий из каталогов с UPAT и лицевыми SF-36 (которые на этот момент уже должны быть в Гите), слить их в один, отсортировать случайно на RANDOM.ORG, закоммитить,— и вот тогда уже приступить к занесению.
> 
> [00:33, 7.3.2019] Павел: Теперь уже просто: берете просто по порядку из этого случайного списка название, находите в 7-м каталоге, и заносите.
> 
> [00:33, 7.3.2019] Павел: Случайная сортировка же улучшит нам дело нас на случай, если вдруг не успеете внести все опросники.
> 
> [00:36, 7.3.2019] Павел: А я тем временем допишу актуальность, цель и методы (черновой вариант, который мы с Вами обговорили по телефону, уже тоже должен быть на тот момент в Гите), и к вечеру четверга приступлю к анализу того, что Вы успеете к тому времени навносить.
> 
> [00:37, 7.3.2019] Павел: Пока я буду анализировать, Вам нужно будет к утру пятницы написать итоговый текст тезисов, чтобы утром в пятницу уже просто внести в него числа, и чтобы мне осталось скомпилировать его по накатанной технике (в R Studio) в документ Word, и он будет готов к отправке ДИК на проверку.

## Сроки

До окончания срока подачи тезисов - 5 суток. Решили с ПВЖ остановится на оцифровке опросников и установления исходных значений показателей по ним

План на 2019-03-05: 

1. изучить работу Cook2015. 
2. Отразить в гите обсуждёный план тезисов
3. Установить MGit.
4. Создать в FormTools внутреннюю форму для перенесения первичных сведений из оцифрованных в качестве фотографий опросников (36 полей для SF-36, 3 поля для UPAT) — готово (262577a020f30730ddf4d30a7ed23d01e97ff388); см. также другие сегодняшние коммиты в xs-stmz-methodology.

    Об оцифровке опросников см.: a165be0ed057a8976f7bf03bba0ff9589fdeb226.
